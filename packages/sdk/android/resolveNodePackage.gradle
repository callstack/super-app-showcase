// source: https://github.com/facebook/react-native/pull/39520
// TODO remove in the future when this lands in RN
// modified to better support resolving symlinks(junctions) on Windows

import java.nio.file.*

ext.resolveNodePackage = { String packageName, File startDir ->
    def startPath = startDir.toPath()
    def candidate = startPath.resolve("node_modules").resolve(packageName)

    if (Files.exists(candidate)) {
        return candidate.toRealPath().toFile()
    }

    def parentDir = startPath.parent
    if (parentDir == null || startPath.toRealPath() == parentDir.toRealPath()) {
        throw new GradleException("Failed to find the package '$packageName'. Ensure you have installed node_modules.")
    }

    return resolveNodePackage(packageName, parentDir.toFile())
}